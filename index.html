<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green P2P Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; margin: 0; padding: 0; background-color: #1a3c2e; color: #d3d3d3; display: flex; flex-direction: column; min-height: 100vh; }
        .container { flex: 1; max-width: 400px; margin: 0 auto; padding: 10px; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #2e5a47; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-info img { width: 40px; height: 40px; border-radius: 50%; }
        .tabs { display: flex; justify-content: space-around; padding: 10px 0; background-color: #224d3a; border-radius: 10px; margin: 10px 0; }
        .tabs button { background: none; border: none; color: #d3d3d3; cursor: pointer; font-size: 16px; }
        .tabs .active { color: #f1c40f; }
        .filters { display: flex; flex-direction: column; gap: 5px; margin-bottom: 15px; }
        form { display: flex; flex-direction: column; gap: 10px; }
        input, select { padding: 10px; border-radius: 5px; border: 1px solid #2e5a47; background-color: #1a3c2e; color: #d3d3d3; }
        button { background-color: #f1c40f; color: #1a3c2e; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .offer { border-bottom: 1px dashed #d3d3d3; padding: 10px 0; }
        .footer { display: flex; justify-content: space-around; padding: 10px 0; background-color: #1a3c2e; border-top: 1px solid #2e5a47; }
        .footer button { background: none; border: none; color: #d3d3d3; cursor: pointer; font-size: 16px; }
        .footer .active { color: #f1c40f; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button onclick="history.back()">←</button>
            <div class="user-info">
                <img src="https://via.placeholder.com/40" alt="User Avatar">
                <div>
                    <p>{{ user.email[:3] }}****@*****.com</p>
                    <p>UID: {{ user.id }}123456</p>
                </div>
            </div>
            <span>{{ now.strftime('%H:%M') }}</span>
        </div>

        <div class="tabs">
            <button class="{% if tab == 'buy' %}active{% endif %}" onclick="window.location.href='/?tab=buy'">Покупка</button>
            <button class="{% if tab == 'sell' %}active{% endif %}" onclick="window.location.href='/?tab=sell'">Продажа</button>
        </div>

        <div class="filters">
            <form action="/offers/filter" method="get">
                <input type="hidden" name="offer_type" value="{{ tab }}">
                <select name="currency">
                    <option value="">USDT</option>
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="TON">TON</option>
                </select>
                <select name="fiat">
                    <option value="">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
                <input type="number" name="amount" placeholder="Сумма">
                <select name="payment_method">
                    <option value="">SBP</option>
                    <option value="Sberbank">Sberbank</option>
                    <option value="Tinkoff">Tinkoff</option>
                    <option value="YooMoney">YooMoney</option>
                    <option value="Cash">Cash</option>
                </select>
                <label><input type="checkbox" name="only_verified"> Только с верификацией</label>
                <label><input type="checkbox" name="only_online"> Только онлайн</label>
                <label><input type="checkbox" name="only_merchants"> Только мерчанты</label>
                <button type="submit">Фильтровать</button>
            </form>
        </div>

        <div class="offers">
            <h3>Объявления</h3>
            {% for offer in offers %}
                <div class="offer">
                    <p>Пользователь: user{{ offer.user_id }} <span style="color: {{ '#0f0' if offer.user.last_seen > now - timedelta(minutes=15) else '#f00' }}">●</span></p>
                    <p>Время активности: {{ (now - offer.created_at).seconds // 60 }} мин.</p>
                    <p>Курс: {{ offer.fiat_amount / offer.amount | round(2) }} {{ offer.fiat }}/{{ offer.currency }}</p>
                    <p>Количество: {{ offer.amount }} {{ offer.currency }}</p>
                    <p>Лимиты: {{ offer.amount * 0.5 | round(2) }} – {{ offer.fiat_amount }} {{ offer.fiat }}</p>
                    <p>Метод: {{ offer.payment_method }}</p>
                    <p>Статистика: {{ offer.user.orders_completed }} ордеров | {{ offer.user.rating }}%</p>
                    <form action="/buy-offer/{{ offer.id }}" method="post">
                        <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
                        <input type="hidden" name="token" value="YOUR_TOKEN">
                        <button type="submit">{{ "Покупка" if offer.offer_type == "sell" else "Продажа" }}</button>
                    </form>
                </div>
            {% endfor %}
        </div>

        <div class="create-offer">
            <h3>Создать объявление</h3>
            <form action="/create-offer" method="post">
                <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="token" value="YOUR_TOKEN">
                <select name="offer_type" required>
                    <option value="buy">Покупка</option>
                    <option value="sell">Продажа</option>
                </select>
                <select name="currency" required>
                    <option value="USDT">USDT</option>
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="TON">TON</option>
                </select>
                <input type="number" name="amount" step="0.01" placeholder="Количество (500-5000)" min="500" max="5000" required>
                <select name="fiat" required>
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
                <input type="number" name="fiat_amount" step="0.01" placeholder="Фиатная сумма" required>
                <select name="payment_method" required>
                    <option value="SBP">SBP</option>
                    <option value="Sberbank">Sberbank</option>
                    <option value="Tinkoff">Tinkoff</option>
                    <option value="YooMoney">YooMoney</option>
                    <option value="Cash">Cash</option>
                </select>
                <input type="text" name="contact" placeholder="Контактная информация" required>
                <input type="number" name="payment_window" placeholder="Время оплаты (минуты)" value="15" required>
                <label><input type="checkbox" name="only_verified"> Только для верифицированных</label>
                <label><input type="checkbox" name="only_vip"> Только для VIP</label>
                <textarea name="description" placeholder="Описание объявления"></textarea>
                <button type="submit">Создать</button>
            </form>
        </div>
    </div>

    <div class="footer">
        <button class="active" onclick="window.location.href='/'">P2P</button>
        <button onclick="window.location.href='/orders'">Orders</button>
        <button onclick="window.location.href='/ads'">Ads</button>
        <button onclick="window.location.href='/profile'">Profile</button>
    </div>
</body>
</html>
