<!DOCTYPE html>
<html lang="ru">
<head><meta charset="UTF-8"><title>Рынок P2P</title>
<link rel="stylesheet" href="/static/styles.css"></head>
<body>
  <div class="header">
    <h1>Рынок P2P</h1>
    <a href="/create" class="create-button">+ Создать объявление</a>
    <button class="icon-btn" onclick="openSettings()">⚙️</button>
  </div>
  <div id="settingsModal" class="modal" onclick="if(event.target.id==='settingsModal')closeSettings()">
    <div class="modal-content">
      <span class="close-btn" onclick="closeSettings()">✖️</span>
      <h2>Настройки</h2>
      <p><strong>Пользователь:</strong> {{ current_user }}</p>
      <p><strong>Баланс:</strong> {{ balances[current_user]|round(2) }} USDT</p>
      <a href="/deposit"><button>Пополнить</button></a>
      <a href="/withdraw"><button>Вывести</button></a>
      <a href="/profile"><button>Профиль</button></a>
      <p><strong>Адрес:</strong><br><a href="#">usdt:ВАШ_АДРЕС</a></p>
    </div>
  </div>
  <div class="market-container">
    {% if ads %}
      {% for ad in ads %}
        <div class="ad-card">
          <h3>{{ ad.action|capitalize }} {{ ad.crypto }}</h3>
          <p>Цена: {{ ad.rate }} {{ ad.fiat }}</p>
          <p>Доступно: {{ ad.amount }} {{ ad.crypto }}</p>
          <p>Лимиты: от {{ ad.min_limit }} до {{ ad.max_limit }} {{ ad.fiat }}</p>
          <p>Продавец: {{ ad.owner }} (Рейтинг {{ ad.rating }}%, Ордеры {{ ad.completed_orders }})</p>
          <a class="buy-button" href="/trade/{{ ad.id }}">Купить</a>
        </div>
      {% endfor %}
    {% else %}
      <p>Объявлений нет.</p>
    {% endif %}
  </div>
  <script>
    function openSettings(){document.getElementById('settingsModal').style.display='block';}
    function closeSettings(){document.getElementById('settingsModal').style.display='none';}
  </script>
</body>
</html>
