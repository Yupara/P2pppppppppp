<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green P2P Exchange - Покупка/Продажа</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1C2526;
            color: #D3D3D3;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .header button {
            background: none;
            border: none;
            color: #D3D3D3;
            font-size: 16px;
            cursor: pointer;
        }
        .offer-details {
            background: #2A3438;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .offer-details p {
            margin: 5px 0;
        }
        .offer-details .price {
            color: #F4A261;
            font-size: 18px;
        }
        .offer-details .timer {
            color: #F4A261;
        }
        .offer-details .methods {
            color: #A9CBA2;
        }
        .amount-section {
            background: #2A3438;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .amount-section select, .amount-section input {
            background: #3A4448;
            border: none;
            color: #D3D3D3;
            padding: 5px;
            border-radius: 5px;
            width: 100%;
            margin-bottom: 10px;
        }
        .amount-section button {
            background: #F4A261;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            cursor: pointer;
        }
        .seller-info {
            background: #2A3438;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .seller-info p {
            margin: 5px 0;
        }
        .seller-info .bank-select {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .seller-info .bank-select select {
            background: #3A4448;
            border: none;
            color: #D3D3D3;
            padding: 5px;
            border-radius: 5px;
            flex-grow: 1;
        }
        .seller-info .bank-select button {
            background: none;
            border: none;
            color: #F4A261;
            cursor: pointer;
        }
        .transaction-details {
            background: #2A3438;
            padding: 10px;
            border-radius: 10px;
        }
        .transaction-details a {
            color: #F4A261;
            text-decoration: none;
        }
        .transaction-details .stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-top: 10px;
        }
        .transaction-details .stats div {
            flex: 1 1 45%;
            margin-bottom: 5px;
        }
        .footer {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: #1C2526;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        .footer button {
            background: none;
            border: none;
            color: #D3D3D3;
            font-size: 16px;
            cursor: pointer;
        }
        .footer button.active {
            color: #F4A261;
        }
        .error {
            color: #FF5555;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        {% if offer %}
        <div class="header">
            <button onclick="window.location.href='/'">←</button>
            <h2>{{ "Покупка" if offer.offer_type == "sell" else "Продажа" }} {{ offer.currency }}</h2>
            <span>{{ now.strftime('%H:%M') }}</span>
        </div>

        <div class="offer-details">
            <p class="price">Цена {{ (offer.fiat_amount / offer.amount) | round(2) }} {{ offer.fiat }} <span class="timer">40с</span></p>
            <p>Количество {{ offer.amount }} {{ offer.currency }}</p>
            <p class="methods">Способы оплаты | {{ offer.payment_method }} {% if offer.payment_method == 'Sberbank' %}| Совкомбанк{% endif %}</p>
            <p>Лимиты оплаты {{ (offer.amount * 0.5) | round(2) }} – {{ offer.fiat_amount }} {{ offer.fiat }}</p>
            <p>За флат <span class="timer">3а критиювалюту</span></p>
        </div>

        <div class="amount-section">
            <select name="fiat">
                <option value="RUB" {% if offer.fiat == 'RUB' %}selected{% endif %}>RUB</option>
                <option value="USD" {% if offer.fiat == 'USD' %}selected{% endif %}>USD</option>
                <option value="EUR" {% if offer.fiat == 'EUR' %}selected{% endif %}>EUR</option>
                <option value="KZT" {% if offer.fiat == 'KZT' %}selected{% endif %}>KZT</option>
                <option value="UAH" {% if offer.fiat == 'UAH' %}selected{% endif %}>UAH</option>
                <option value="TRY" {% if offer.fiat == 'TRY' %}selected{% endif %}>TRY</option>
                <option value="CNY" {% if offer.fiat == 'CNY' %}selected{% endif %}>CNY</option>
                <option value="INR" {% if offer.fiat == 'INR' %}selected{% endif %}>INR</option>
                <option value="BRL" {% if offer.fiat == 'BRL' %}selected{% endif %}>BRL</option>
                <option value="AED" {% if offer.fiat == 'AED' %}selected{% endif %}>AED</option>
                <option value="JPY" {% if offer.fiat == 'JPY' %}selected{% endif %}>JPY</option>
                <option value="KRW" {% if offer.fiat == 'KRW' %}selected{% endif %}>KRW</option>
                <option value="THB" {% if offer.fiat == 'THB' %}selected{% endif %}>THB</option>
                <option value="SGD" {% if offer.fiat == 'SGD' %}selected{% endif %}>SGD</option>
                <option value="MYR" {% if offer.fiat == 'MYR' %}selected{% endif %}>MYR</option>
                <option value="IDR" {% if offer.fiat == 'IDR' %}selected{% endif %}>IDR</option>
                <option value="PHP" {% if offer.fiat == 'PHP' %}selected{% endif %}>PHP</option>
                <option value="VND" {% if offer.fiat == 'VND' %}selected{% endif %}>VND</option>
                <option value="ZAR" {% if offer.fiat == 'ZAR' %}selected{% endif %}>ZAR</option>
                <option value="NGN" {% if offer.fiat == 'NGN' %}selected{% endif %}>NGN</option>
                <option value="EGP" {% if offer.fiat == 'EGP' %}selected{% endif %}>EGP</option>
                <option value="KES" {% if offer.fiat == 'KES' %}selected{% endif %}>KES</option>
                <option value="MXN" {% if offer.fiat == 'MXN' %}selected{% endif %}>MXN</option>
                <option value="ARS" {% if offer.fiat == 'ARS' %}selected{% endif %}>ARS</option>
                <option value="COP" {% if offer.fiat == 'COP' %}selected{% endif %}>COP</option>
                <option value="CLP" {% if offer.fiat == 'CLP' %}selected{% endif %}>CLP</option>
                <option value="SAR" {% if offer.fiat == 'SAR' %}selected{% endif %}>SAR</option>
                <option value="QAR" {% if offer.fiat == 'QAR' %}selected{% endif %}>QAR</option>
                <option value="GBP" {% if offer.fiat == 'GBP' %}selected{% endif %}>GBP</option>
                <option value="AUD" {% if offer.fiat == 'AUD' %}selected{% endif %}>AUD</option>
                <option value="CAD" {% if offer.fiat == 'CAD' %}selected{% endif %}>CAD</option>
                <option value="CHF" {% if offer.fiat == 'CHF' %}selected{% endif %}>CHF</option>
                <option value="SEK" {% if offer.fiat == 'SEK' %}selected{% endif %}>SEK</option>
                <option value="NOK" {% if offer.fiat == 'NOK' %}selected{% endif %}>NOK</option>
                <option value="DKK" {% if offer.fiat == 'DKK' %}selected{% endif %}>DKK</option>
                <option value="PLN" {% if offer.fiat == 'PLN' %}selected{% endif %}>PLN</option>
            </select>
            <input type="number" name="amount" placeholder="Введите сумму" step="0.01" required>
            <form action="/buy-offer/{{ offer.id }}" method="post">
                <button type="submit">{{ "Покупка" if offer.offer_type == "sell" else "Продажа" }}</button>
            </form>
        </div>

        <div class="seller-info">
            <p>Условия мейкера</p>
            <div class="bank-select">
                <select name="bank">
                    <option value="T-Bank">Т-Банк</option>
                    <option value="Sberbank">Сбербанк</option>
                    <option value="Tinkoff">Тинькофф</option>
                    <option value="Alfa-Bank">Альфа-Банк</option>
                    <option value="VTB">ВТБ</option>
                    <option value="Gazprombank">Газпромбанк</option>
                    <option value="Rosbank">Росбанк</option>
                    <option value="Raiffeisenbank">Райффайзенбанк</option>
                </select>
                <button>→</button>
            </div>
            <p>Принимаю оплату от {{ offer.payment_method }}, перевод по номеру карты!</p>
        </div>

        <div class="transaction-details">
            <p>Сведения о транзакции</p>
            <a href="/profile/{{ offer.user.id }}">{{ offer.user.email.split('@')[0] }} <span>→</span></a>
            <div class="stats">
                <div><p>Высокий рейтинг %</p><p>{{ offer.user.rating if offer.user.rating else '99%' }}</p></div>
                <div><p>Исполненные ордера за 30 дней</p><p>{{ offer.user.orders_completed }} Ордера</p></div>
                <div><p>Процент исполнения за 30 дней (%)</p><p>{{ offer.user.completion_rate if offer.user.completion_rate else '100%' }}</p></div>
                <div><p>Средн. время перевода</p><p>{{ offer.user.avg_transfer_time if offer.user.avg_transfer_time else '2 мин.' }}</p></div>
            </div>
        </div>
        {% else %}
        <div class="error">
            <h2>Ошибка</h2>
            <p>Объявление не найдено.</p>
            <button onclick="window.location.href='/'">Вернуться на главную</button>
        </div>
        {% endif %}
    </div>

    <div class="footer">
        <button onclick="window.location.href='/'">P2P</button>
        <button onclick="window.location.href='/orders'">Orders</button>
        <button onclick="window.location.href='/ads'">Ads</button>
        <button onclick="window.location.href='/profile'">Profile</button>
    </div>
</body>
</html>
