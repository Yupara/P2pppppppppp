<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green P2P Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <button onclick="history.back()">←</button>
            <div class="user-info">
                <img src="https://via.placeholder.com/40" alt="User Avatar">
                <div>
                    <p>{{ user.email[:3] }}****@*****.com</p>
                    <p>UID: {{ user.id }}123456</p>
                </div>
            </div>
            <span>{{ now.strftime('%H:%M') }}</span>
        </div>

        <div class="tabs">
            <button class="{% if tab == 'buy' %}active{% endif %}" onclick="window.location.href='/?tab=buy'">Покупка</button>
            <button class="{% if tab == 'sell' %}active{% endif %}" onclick="window.location.href='/?tab=sell'">Продажа</button>
        </div>

        <div class="filters">
            <form action="/offers/filter" method="get">
                <input type="hidden" name="offer_type" value="{{ tab }}">
                <select name="currency">
                    <option value="">USDT</option>
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="TON">TON</option>
                </select>
                <select name="fiat">
                    <option value="">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
                <input type="number" name="amount" placeholder="Сумма">
                <select name="payment_method">
                    <option value="">SBP</option>
                    <option value="Sberbank">Sberbank</option>
                    <option value="Tinkoff">Tinkoff</option>
                    <option value="YooMoney">YooMoney</option>
                    <option value="Cash">Cash</option>
                </select>
                <label><input type="checkbox" name="only_verified"> Только с верификацией</label>
                <label><input type="checkbox" name="only_online"> Только онлайн</label>
                <label><input type="checkbox" name="only_merchants"> Только мерчанты</label>
                <button type="submit">Фильтровать</button>
            </form>
        </div>

        <div class="offers">
            <h3>Объявления</h3>
            {% for offer in offers %}
                <div class="offer">
                    <p>Пользователь: user{{ offer.user_id }} <span style="color: {{ '#0f0' if offer.user.last_seen > now - timedelta(minutes=15) else '#f00' }}">●</span></p>
                    <p>Время активности: {{ (now - offer.created_at).seconds // 60 }} мин.</p>
                    <p>Курс: {{ (offer.fiat_amount / offer.amount) | round(2) }} {{ offer.fiat }}/{{ offer.currency }}</p>
                    <p>Количество: {{ offer.amount }} {{ offer.currency }}</p>
                    <p>Лимиты: {{ (offer.amount * 0.5) | round(2) }} – {{ offer.fiat_amount }} {{ offer.fiat }}</p>
                    <p>Метод: {{ offer.payment_method }}</p>
                    <p>Статистика: {{ offer.user.orders_completed }} ордеров | {{ offer.user.rating }}%</p>
                    <form action="/buy-offer/{{ offer.id }}" method="post">
                        <button type="submit">{{ "Покупка" if offer.offer_type == "sell" else "Продажа" }}</button>
                    </form>
                </div>
            {% endfor %}
        </div>

        <div class="create-offer">
            <h3>Создать объявление</h3>
            <form action="/create-offer" method="post">
                <select name="offer_type" required>
                    <option value="buy">Покупка</option>
                    <option value="sell">Продажа</option>
                </select>
                <select name="currency" required>
                    <option value="USDT">USDT</option>
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="TON">TON</option>
                </select>
                <input type="number" name="amount" step="0.01" placeholder="Количество (500-5000)" min="500" max="5000" required>
                <select name="fiat" required>
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
                <input type="number" name="fiat_amount" step="0.01" placeholder="Фиатная сумма" required>
                <select name="payment_method" required>
                    <option value="SBP">SBP</option>
                    <option value="Sberbank">Sberbank</option>
                    <option value="Tinkoff">Tinkoff</option>
                    <option value="YooMoney">YooMoney</option>
                    <option value="Cash">Cash</option>
                </select>
                <input type="text" name="contact" placeholder="Контактная информация" required>
                <input type="number" name="payment_window" placeholder="Время оплаты (минуты)" value="15" required>
                <label><input type="checkbox" name="only_verified"> Только для верифицированных</label>
                <label><input type="checkbox" name="only_vip"> Только для VIP</label>
                <textarea name="description" placeholder="Описание объявления"></textarea>
                <button type="submit">Создать</button>
            </form>
        </div>
    </div>

    <div class="footer">
        <button class="active" onclick="window.location.href='/'">P2P</button>
        <button onclick="window.location.href='/orders'">Orders</button>
        <button onclick="window.location.href='/ads'">Ads</button>
        <button onclick="window.location.href='/profile'">Profile</button>
    </div>
</body>
</html>
