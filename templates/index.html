<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green P2P Exchange</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1A3C34;
            color: #A9CBA2;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        .tabs button {
            background: none;
            border: none;
            color: #A9CBA2;
            font-size: 16px;
            padding: 10px;
            cursor: pointer;
        }
        .tabs button.active {
            color: #FFCA28;
            border-bottom: 2px solid #FFCA28;
        }
        .filters {
            background: #1E4A40;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .filters form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .filters select, .filters input[type="number"] {
            background: #2A5D50;
            border: none;
            color: #A9CBA2;
            padding: 5px;
            border-radius: 5px;
        }
        .filters button {
            background: #2E7D32;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .offers {
            margin-bottom: 10px;
        }
        .offer {
            background: #1E4A40;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .offer p {
            margin: 5px 0;
        }
        .offer .status {
            color: #FFCA28;
        }
        .offer button {
            background: #2E7D32;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .create-offer {
            background: #1E4A40;
            padding: 10px;
            border-radius: 10px;
        }
        .create-offer form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .create-offer select, .create-offer input, .create-offer textarea {
            background: #2A5D50;
            border: none;
            color: #A9CBA2;
            padding: 5px;
            border-radius: 5px;
        }
        .create-offer button {
            background: #2E7D32;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .footer {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: #1A3C34;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        .footer button {
            background: none;
            border: none;
            color: #A9CBA2;
            font-size: 16px;
            cursor: pointer;
        }
        .footer button.active {
            color: #FFCA28;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button onclick="history.back()">‚Üê</button>
            <div class="tabs">
                <button class="{% if tab == 'buy' %}active{% endif %}" onclick="window.location.href='/?tab=buy'">–ü–æ–∫—É–ø–∫–∞</button>
                <button class="{% if tab == 'sell' %}active{% endif %}" onclick="window.location.href='/?tab=sell'">–ü—Ä–æ–¥–∞–∂–∞</button>
            </div>
            <span>{{ now.strftime('%H:%M') }}</span>
        </div>

        <div class="filters">
            <form action="/offers/filter" method="get">
                <input type="hidden" name="offer_type" value="{{ tab }}">
                <select name="currency">
                    <option value="USDT" {% if not currency %}selected{% endif %}>USDT</option>
                    <option value="BTC" {% if currency == 'BTC' %}selected{% endif %}>BTC</option>
                    <option value="ETH" {% if currency == 'ETH' %}selected{% endif %}>ETH</option>
                    <option value="TON" {% if currency == 'TON' %}selected{% endif %}>TON</option>
                </select>
                <select name="fiat">
                    <option value="RUB" {% if not fiat %}selected{% endif %}>RUB</option>
                    <option value="USD" {% if fiat == 'USD' %}selected{% endif %}>USD</option>
                    <option value="EUR" {% if fiat == 'EUR' %}selected{% endif %}>EUR</option>
                </select>
                <input type="number" name="amount" placeholder="–°—É–º–º–∞" value="{{ amount if amount else '' }}">
                <select name="payment_method">
                    <option value="" {% if not payment_method %}selected{% endif %}>SBP</option>
                    <option value="Sberbank" {% if payment_method == 'Sberbank' %}selected{% endif %}>Sberbank</option>
                    <option value="Tinkoff" {% if payment_method == 'Tinkoff' %}selected{% endif %}>Tinkoff</option>
                    <option value="YooMoney" {% if payment_method == 'YooMoney' %}selected{% endif %}>YooMoney</option>
                    <option value="Cash" {% if payment_method == 'Cash' %}selected{% endif %}>Cash</option>
                </select>
                <label><input type="checkbox" name="only_verified" {% if only_verified %}checked{% endif %}> –¢–æ–ª—å–∫–æ —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π</label>
                <label><input type="checkbox" name="only_online" {% if only_online %}checked{% endif %}> –¢–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω</label>
                <label><input type="checkbox" name="only_merchants" {% if only_merchants %}checked{% endif %}> –¢–æ–ª—å–∫–æ –º–µ—Ä—á–∞–Ω—Ç—ã</label>
                <button type="submit">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
            </form>
        </div>

        <div class="offers">
            <h3>–û–±—ä—è–≤–ª–µ–Ω–∏—è</h3>
            {% for offer in offers %}
                <div class="offer">
                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ offer.user.email.split('@')[0] }} <span class="status" style="color: {{ '#2E7D32' if offer.user.last_seen > now - timedelta(minutes=15) else '#FFCA28' }}">‚óè</span> <span class="status">{{ offer.user.orders_completed }} –û—Ä–¥–µ—Ä–æ–≤ | {{ '10%' }}</span></p>
                    <p>–ö—É—Ä—Å: {{ (offer.fiat_amount / offer.amount) | round(2) }} {{ offer.fiat }}/{{ offer.currency }}</p>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ offer.amount }} {{ offer.currency }}</p>
                    <p>–õ–∏–º–∏—Ç—ã: {{ (offer.amount * 0.5) | round(2) }} ‚Äì {{ offer.fiat_amount }} {{ offer.fiat }}</p>
                    <p>–ú–µ—Ç–æ–¥: {{ offer.payment_method }} {% if offer.payment_method == 'SBP' %}<span>üí≥</span>{% else %}<span>‚öôÔ∏è</span>{% endif %}</p>
                    <form action="/buy-offer/{{ offer.id }}" method="post">
                        <button type="submit">–ü–æ–∫—É–ø–∫–∞</button>
                    </form>
                </div>
            {% endfor %}
        </div>

        <div class="create-offer">
            <h3>–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>
            <form action="/create-offer" method="post">
                <select name="offer_type" required>
                    <option value="buy">–ü–æ–∫—É–ø–∫–∞</option>
                    <option value="sell">–ü—Ä–æ–¥–∞–∂–∞</option>
                </select>
                <select name="currency" required>
                    <option value="USDT">USDT</option>
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="TON">TON</option>
                </select>
                <input type="number" name="amount" step="0.01" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (500-5000)" min="500" max="5000" required>
                <select name="fiat" required>
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
                <input type="number" name="fiat_amount" step="0.01" placeholder="–§–∏–∞—Ç–Ω–∞—è —Å—É–º–º–∞" required>
                <select name="payment_method" required>
                    <option value="SBP">SBP</option>
                    <option value="Sberbank">Sberbank</option>
                    <option value="Tinkoff">Tinkoff</option>
                    <option value="YooMoney">YooMoney</option>
                    <option value="Cash">Cash</option>
                </select>
                <input type="text" name="contact" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" required>
                <input type="number" name="payment_window" placeholder="–í—Ä–µ–º—è –æ–ø–ª–∞—Ç—ã (–º–∏–Ω—É—Ç—ã)" value="15" required>
                <label><input type="checkbox" name="only_verified"> –¢–æ–ª—å–∫–æ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</label>
                <label><input type="checkbox" name="only_vip"> –¢–æ–ª—å–∫–æ –¥–ª—è VIP</label>
                <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"></textarea>
                <button type="submit">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</button>
            </form>
        </div>
    </div>

    <div class="footer">
        <button class="{% if request.path == '/' %}active{% endif %}" onclick="window.location.href='/'">P2P</button>
        <button class="{% if request.path == '/orders' %}active{% endif %}" onclick="window.location.href='/orders'">Orders</button>
        <button class="{% if request.path == '/ads' %}active{% endif %}" onclick="window.location.href='/ads'">Ads</button>
        <button class="{% if request.path == '/profile' %}active{% endif %}" onclick="window.location.href='/profile'">Profile</button>
    </div>
</body>
</html>
