{% extends "base.html" %}
{% block title %}Сделка №{{ trade.id }}{% endblock %}
{% block content %}
<h1>Сделка №{{ trade.id }}</h1>

<div class="trade-info">
  <p><strong>Объявление:</strong> {{ trade.ad.crypto }}/{{ trade.ad.fiat }}</p>
  <p><strong>Сумма:</strong> {{ trade.amount }}</p>
  <p><strong>Цена:</strong> {{ trade.ad.price }}</p>
  <p><strong>Статус:</strong> {{ trade.status }}</p>
  <p><strong>Окончание:</strong> <span id="timer"></span></p>
</div>

<div class="actions">
  {% if is_buyer and trade.status=="pending" %}
    <form action="/trade/{{ trade.id }}/paid" method="post"><button>Я оплатил</button></form>
  {% endif %}
  {% if is_seller and trade.status=="paid" %}
    <form action="/trade/{{ trade.id }}/confirm" method="post"><button>Подтвердить</button></form>
  {% endif %}
</div>

<script>
 const exp = new Date("{{ trade.expires_at.isoformat() }}");
 const el  = document.getElementById("timer");
 setInterval(()=>{
   let d=exp-new Date();
   if(d<=0){ el.textContent="Время вышло"; return; }
   let m=Math.floor(d/60000), s=Math.floor((d%60000)/1000);
   el.textContent=m+":"+(s<10?"0"+s:s);
 },1000);
</script>
{% endblock %}
