{% extends "base.html" %}

{% block content %}
<div class="trade-container">
  <h2>Сделка №{{ trade.id }}</h2>

  <div class="trade-details">
    <p><strong>Сумма:</strong> {{ trade.amount }} USDT</p>
    <p><strong>Цена:</strong> {{ trade.price }} {{ trade.fiat_currency }}</p>
    <p><strong>Метод оплаты:</strong> {{ trade.payment_method }}</p>
  </div>

  <div class="trade-timer">
    <strong>Оставшееся время:</strong>
    <span id="countdown">30:00</span>
  </div>

  <div class="trade-buttons">
    <button onclick="markPaid()">Я оплатил</button>
    <button onclick="confirmReceived()">Подтвердить получение</button>
    <button onclick="openDispute()">Открыть спор</button>
  </div>

  <div class="chat-section">
    <h3>Чат сделки</h3>
    <div id="chat-box" class="chat-box"></div>
    <input type="text" id="chat-input" placeholder="Напишите сообщение..." />
    <button onclick="sendMessage()">Отправить</button>
  </div>
</div>

<script>
  // Таймер 30 минут (1800 секунд)
  let timeLeft = 1800;
  const countdown = document.getElementById("countdown");

  function updateTimer() {
    const minutes = String(Math.floor(timeLeft / 60)).padStart(2, "0");
    const seconds = String(timeLeft % 60).padStart(2, "0");
    countdown.textContent = `${minutes}:${seconds}`;
    if (timeLeft > 0) timeLeft--;
  }

  setInterval(updateTimer, 1000);

  // Обработка кнопок (заглушки)
  function markPaid() {
    alert("Вы отметили сделку как оплачено.");
  }

  function confirmReceived() {
    alert("Вы подтвердили получение.");
  }

  function openDispute() {
    alert("Вы открыли спор.");
  }

  // Чат (локальный вывод)
  function sendMessage() {
    const input = document.getElementById("chat-input");
    const message = input.value.trim();
    if (message !== "") {
      const chatBox = document.getElementById("chat-box");
      const msgEl = document.createElement("div");
      msgEl.classList.add("chat-message");
      msgEl.innerHTML = `<strong>Вы:</strong> ${message}`;
      chatBox.appendChild(msgEl);
      input.value = "";
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  }
</script>
{% endblock %}
