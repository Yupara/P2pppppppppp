<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Сделка #{{ trade_id }}</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>Сделка #{{ trade_id }}</h1>

    <div id="chat-box" style="border:1px solid #ccc; padding:10px; height:300px; overflow-y:scroll;">
        {% for message in messages %}
            <p><strong>{{ message.sender }}:</strong> {{ message.text }}</p>
        {% endfor %}
    </div>

    <form id="chat-form" method="post" action="/send_message/{{ trade_id }}">
        <input type="text" name="text" placeholder="Введите сообщение..." required>
        <button type="submit">Отправить</button>
    </form>

    <br>

    <button onclick="markAsPaid()">Я оплатил</button>
    <button onclick="markAsConfirmed()">Подтвердить получение</button>
    <button onclick="openDispute()">Открыть спор</button>

    <script>
        function markAsPaid() {
            fetch('/trades/{{ trade_id }}/mark_paid', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert(data.message));
        }

        function markAsConfirmed() {
            fetch('/trades/{{ trade_id }}/mark_confirmed', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert(data.message));
        }

        function openDispute() {
            fetch('/trades/{{ trade_id }}/dispute', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert(data.message));
        }
    </script>
</body>
</html>
