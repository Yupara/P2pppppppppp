<!-- templates/trade.html -->

<!DOCTYPE html>
<html>
<head>
  <title>–°–¥–µ–ª–∫–∞</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <h2>–°–¥–µ–ª–∫–∞ ‚Ññ{{ order.id }}</h2>
  <p>–ü—Ä–æ–¥–∞–≤–µ—Ü: {{ order.seller.username }} | –ü–æ–∫—É–ø–∞—Ç–µ–ª—å: {{ order.buyer.username }}</p>
  <p>–°—É–º–º–∞: {{ order.amount }} | –í–∞–ª—é—Ç–∞: {{ order.currency }}</p>

  <hr>
  <h3>–ß–∞—Ç</h3>
  <div class="chat-box">
    {% for message in messages %}
      <div class="message {% if message.sender_id == user.id %}my-message{% endif %}">
        <strong>{{ message.sender.username }}:</strong> {{ message.content }}
        <div class="timestamp">{{ message.timestamp.strftime('%H:%M') }}</div>
      </div>
    {% endfor %}
  </div>

  <form action="/orders/{{ order.id }}/message" method="post">
    <input type="text" name="text" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  <a href="/orders/mine">üîô –ù–∞–∑–∞–¥ –∫ —Å–¥–µ–ª–∫–∞–º</a>
</body>
</html>
<hr>
<h3>–î–µ–π—Å—Ç–≤–∏—è</h3>

{% if order.status == 'active' and order.buyer_id == user.id %}
  <form method="post" action="/orders/{{ order.id }}/paid">
    <button type="submit">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
  </form>
{% endif %}

{% if order.status == 'paid' and order.seller_id == user.id %}
  <form method="post" action="/orders/{{ order.id }}/confirm">
    <button type="submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ</button>
  </form>
{% endif %}

<form method="post" action="/orders/{{ order.id }}/dispute">
  <button type="submit">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–æ—Ä</button>
</form>

<p>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: <strong>{{ order.status }}</strong></p>

<form method="post" action="/orders/{{ order.id }}/dispute">
  <textarea name="reason" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." required></textarea>
  <button type="submit" class="dispute-button">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–æ—Ä</button>
</form>
