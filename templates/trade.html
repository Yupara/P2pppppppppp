<!DOCTYPE html>
<html>
<head>
    <title>Сделка</title>
    <script>
        function startTimer(endTime) {
            const end = new Date(endTime).getTime();
            const timerEl = document.getElementById("timer");

            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = end - now;

                if (distance < 0) {
                    clearInterval(interval);
                    timerEl.innerHTML = "Время истекло!";
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                timerEl.innerHTML = minutes + "m " + seconds + "s ";
            }, 1000);
        }
    </script>
</head>
<body onload="startTimer('{{ end_time }}')">
    <h1>Сделка</h1>
    <p>{{ ad.type }} {{ ad.price }} {{ ad.currency }} — {{ ad.method }}</p>
    <p>⏰ Таймер: <span id="timer"></span></p>

    <h3>Действия:</h3>
    <button>Я оплатил</button>
    <button>Подтвердить получение</button>
    <button>Открыть спор</button>

    <h3>Чат:</h3>
    <form method="post" action="/chat/send">
        <input type="hidden" name="trade_id" value="{{ trade_id }}">
        <input name="message" placeholder="Ваше сообщение" required>
        <button type="submit">Отправить</button>
    </form>
</body>
</html>
