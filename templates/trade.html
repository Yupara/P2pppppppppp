<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–¥–µ–ª–∫–∞</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <div class="navbar">
    <a href="/">üè† –†—ã–Ω–æ–∫</a>
    <a href="/create">‚ûï –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
    <div class="settings-icon" onclick="toggleSettings()">‚öôÔ∏è</div>
  </div>

  <div class="settings-menu" id="settingsMenu">
    <p>üë§ –ü–∞–≤–µ–ª</p>
    <p>–ò—Å–ø–æ–ª–Ω–µ–Ω–æ –æ—Ä–¥–µ—Ä–æ–≤: 55</p>
    <p>–†–µ–π—Ç–∏–Ω–≥: 99%</p>
    <p>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã: –°–±–µ—Ä–±–∞–Ω–∫</p>
    <p><button>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button> <button>–í—ã–≤–æ–¥</button></p>
    <p>–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞: <a href="#">usdt://wallet-link</a></p>
  </div>

  <div class="container">
    <h2>–ü–æ–∫—É–ø–∫–∞ {{ ad.title }}</h2>
    <p>–¶–µ–Ω–∞: {{ ad.price }} {{ ad.payment_method }}</p>
    <p>–î–æ—Å—Ç—É–ø–Ω–æ: {{ ad.amount }} {{ ad.title }}</p>
    <p>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –æ—Ç {{ ad.min_limit }} –¥–æ {{ ad.max_limit }}</p>
    <p>–£—Å–ª–æ–≤–∏—è –º–µ–π–∫–µ—Ä–∞: {{ ad.condition }}</p>

    {% if order_status.get(ad.id) not in ["released", "cancelled"] %}
    <form method="post" action="/trade/{{ ad.id }}/buy">
      <label>–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É ({{ ad.title }}):</label>
      <input type="number" name="amount" required>
      <button type="submit">–ö—É–ø–∏—Ç—å</button>
    </form>
    {% endif %}

    {% if order_status.get(ad.id) == "pending" %}
    <h3>–î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã</h3>
    <form method="post" action="/trade/{{ ad.id }}/pay">
      <input type="text" name="card_number" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã" required><br>
      <input type="text" name="exp_date" placeholder="–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è" required><br>
      <input type="text" name="cvv" placeholder="CVV" required><br>
      <button type="submit">–û–ø–ª–∞—Ç–∏—Ç—å</button>
    </form>
    {% endif %}

    {% if order_status.get(ad.id) == "paid" %}
    <form method="post" action="/trade/{{ ad.id }}/confirm_receipt">
      <button type="submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ</button>
    </form>
    {% endif %}

    {% if order_status.get(ad.id) in ["pending", "paid"] %}
    <form method="post" action="/trade/{{ ad.id }}/cancel">
      <button type="submit">–û—Ç–º–µ–Ω–∏—Ç—å —Å–¥–µ–ª–∫—É</button>
    </form>
    <form method="post" action="/trade/{{ ad.id }}/dispute">
      <button type="submit">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–æ—Ä</button>
    </form>
    {% endif %}

    {% if order_status.get(ad.id) == "released" %}
    <p>‚úÖ –°–¥–µ–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã.</p>
    {% elif order_status.get(ad.id) == "cancelled" %}
    <p>‚ùå –°–¥–µ–ª–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞.</p>
    {% elif order_status.get(ad.id) == "disputed" %}
    <p>‚ö†Ô∏è –°–ø–æ—Ä –æ—Ç–∫—Ä—ã—Ç. –û–∂–∏–¥–∞–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ.</p>
    {% endif %}

    <hr>
    <h3>–ß–∞—Ç —Å–¥–µ–ª–∫–∏</h3>
    <form method="post" action="/trade/{{ ad.id }}/message" enctype="multipart/form-data">
      <input type="text" name="message" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
      <input type="file" name="image">
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <div class="chat">
      {% for msg in messages %}
        <div class="chat-message">
          <strong>{{ msg.user }}</strong>: {{ msg.text }}
          {% if msg.image_url %}
            <div><img src="{{ msg.image_url }}" class="chat-image"></div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    function toggleSettings() {
      const menu = document.getElementById("settingsMenu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }
  </script>
</body>
</html>
